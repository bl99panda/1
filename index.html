<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Хэллоуин Songlist</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nosifer&family=Creepster&display=swap');
        * { margin:0; padding:0; box-sizing:border-box; }
        body, html { background:transparent; font-family:'Creepster',cursive; color:#ffdddd; overflow:hidden; height:100vh; }
        #container { position:relative; width:900px; height:500px; padding:25px; margin:0 auto; }

        .doll { position:absolute; top:15px; left:20px; width:90px; height:110px; z-index:100; filter:drop-shadow(0 0 12px #800000); animation:doll 3.5s infinite; }
        @keyframes doll { 0%,90%,100% { transform:scale(1); } 92% { transform:scale(1.08); } 94% { transform:scale(0.92); } }

        .web { position:absolute; top:0; left:0; width:100%; height:100%; z-index:1; opacity:0.6; background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400"><path fill="none" stroke="%23442200" stroke-width="1.5" opacity="0.5" d="M200 40 Q240 80 280 40 Q320 80 360 40 M200 40 Q160 80 120 40 Q80 80 40 40 M200 40 V360 M40 200 H360 M60 100 Q200 140 340 100 M60 300 Q200 260 340 300"/></svg>') center/contain no-repeat; animation:web 8s infinite; }
        @keyframes web { 0%,100% { opacity:0.5; } 50% { opacity:0.7; } }

        table { width:100%; border-collapse:collapse; z-index:2; }
        th { background:rgba(100,0,0,0.7); color:#ff6666; font-family:'Nosifer',cursive; font-size:19px; padding:14px; text-shadow:0 0 10px #ff0000; border-bottom:3px double #600000; }
        td { background:rgba(30,0,50,0.65); padding:11px; font-size:18px; text-shadow:0 0 8px #800000; border-bottom:1px solid rgba(100,0,0,0.4); }
        tr:nth-child(even) td { background:rgba(40,0,60,0.65); }
        tr:hover td { background:rgba(180,0,0,0.5); transform:translateX(4px); box-shadow:0 0 20px rgba(255,0,0,0.6); }
        .current td { background:linear-gradient(90deg,rgba(200,0,0,0.9),rgba(120,0,0,0.9)); color:#ff9999; font-family:'Nosifer',cursive; border-left:5px solid #ff0000; animation:glow 1.8s infinite; }
        @keyframes glow { 0%,100% { filter:brightness(1); } 50% { filter:brightness(1.6); } }

        @keyframes drip { 0% { transform:translateY(-20px) scale(0.6); opacity:0; } 40% { opacity:1; } 100% { transform:translateY(150px) scale(1); opacity:0; } }
    </style>
</head>
<body>
    <div id="container">
        <div class="doll">
            <svg viewBox="0 0 100 120">
                <circle cx="50" cy="28" r="25" fill="#e8c8b0" stroke="#333" stroke-width="2"/>
                <circle cx="40" cy="25" r="6" fill="#000"/>
                <circle cx="60" cy="25" r="6" fill="#000"/>
                <path d="M38 35 Q50 42 62 35" stroke="#ff0000" stroke-width="3" fill="none"/>
                <path d="M30 55 Q50 70 70 55" stroke="#000" stroke-width="4" fill="none"/>
                <path d="M25 85 Q50 100 75 85 V115 H25 Z" fill="#444"/>
            </svg>
        </div>
        <div class="web"></div>
        <table id="songlist">
            <thead><tr><th>#</th><th>Title</th><th>Artist</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        const STREAMER_ID = 'cover_diva';
        const PAGE_URL = `https://www.streamersonglist.com/t/${STREAMER_ID}/queue`;
        let currentSongId = null;

        async function loadSonglist() {
            try {
                // Используем puppeteer через code_execution
                const response = await fetch('https://api.allorigins.win/raw?url=' + encodeURIComponent(PAGE_URL));
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                // Ждём таблицу (динамическая)
                const table = doc.querySelector('table');
                if (!table) {
                    document.querySelector('#songlist tbody').innerHTML = '<tr><td colspan="3">Загрузка...</td></tr>';
                    setTimeout(loadSonglist, 5000);
                    return;
                }

                const rows = table.querySelectorAll('tr');
                const songs = [];
                rows.forEach((row, i) => {
                    if (i === 0) return;
                    const cells = row.querySelectorAll('td');
                    if (cells.length >= 3) {
                        const title = cells[1].textContent.trim();
                        const artist = cells[2].textContent.trim();
                        if (title && artist) {
                            songs.push({ id: i, title, artist });
                        }
                    }
                });

                if (songs.length > 0) {
                    updateList(songs);
                } else {
                    document.querySelector('#songlist tbody').innerHTML = '<tr><td colspan="3">Очередь пуста</td></tr>';
                }
            } catch (err) {
                document.querySelector('#songlist tbody').innerHTML = '<tr><td colspan="3">Ошибка</td></tr>';
            }
        }

        function updateList(songs) {
            const tbody = document.querySelector('#songlist tbody');
            tbody.innerHTML = '';
            songs.forEach((song, i) => {
                const row = document.createElement('tr');
                if (i === 0) row.className = 'current';
                row.innerHTML = `<td>${i+1}</td><td>${song.title}</td><td>${song.artist}</td>`;
                tbody.appendChild(row);

                if (i === 0 && song.id !== currentSongId) {
                    currentSongId = song.id;
                    createBloodDrops();
                }
            });
        }

        function createBloodDrops() {
            for (let i = 0; i < 7; i++) {
                setTimeout(() => {
                    const drop = document.createElement('div');
                    drop.style.cssText = `position:absolute;width:7px;height:12px;background:#8B0000;border-radius:50% 50% 50% 0;transform:rotate(-25deg);left:${Math.random()*70+15}%;top:-10px;box-shadow:0 0 8px #800000;animation:drip 2s ease-out forwards;z-index:100;pointer-events:none;`;
                    document.getElementById('container').appendChild(drop);
                    setTimeout(() => drop.remove(), 2000);
                }, i * 160);
            }
        }

        loadSonglist();
        setInterval(loadSonglist, 15000);
    </script>
</body>
</html>
